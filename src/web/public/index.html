<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#1a1a1a" />
    <title id="page-title">Bot Status</title>

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" />
    <link rel="manifest" href="/images/site.webmanifest" />
    <link rel="shortcut icon" href="/images/favicon.ico" />

    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Bot Status" />

    <!-- Styles -->
    <link rel="stylesheet" href="styles-unified.css" />
    <link rel="stylesheet" href="deleted-messages-enhancements.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      integrity="sha384-3B6NwesSXE7YJlcLI9RpRqGf2p/EgVH8BgoKTaUrmKNDkHPStTQ3EyoYjCGXaOTS"
      crossorigin="anonymous"
    />

    <!-- Chart.js for graphs -->
    <script
      src="https://cdn.jsdelivr.net/npm/chart.js"
      integrity="sha384-XcdcwHqIPULERb2yDEM4R0XaQKU3YnDsrTmjACBZyfdVVqjh6xQ4/DCMd7XLcA6Y"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"
      integrity="sha384-3N9GHhCtN3CQef6tNfqgZlv7sQLYIkcChN+uaTZ7xVdzKYp/SjBNPxa92+hM7EAY"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="container">
      <!-- Unified Header -->
      <header>
        <div class="logo">
          <i class="fas fa-robot"></i>
          <h1 id="bot-name-header">Bot Status</h1>
        </div>
        <div class="header-controls">
          <!-- Critical Status Indicators -->
          <div id="status-indicator" class="status-indicator">
            <span class="dot"></span>
            <span class="status-text">Checking...</span>
          </div>
          <div id="conversation-mode" class="conversation-mode">
            <span class="mode-icon">üí¨</span>
            <span class="mode-text" title="Conversation Mode">Loading...</span>
          </div>
          <!-- Quick Actions -->
          <button id="theme-toggle" class="btn-icon" title="Toggle Theme">
            <i class="fas fa-moon"></i>
          </button>
          <div class="time" id="currentTime">00:00:00</div>
        </div>
      </header>

      <!-- Tab Navigation -->
      <nav class="tab-navigation">
        <button class="tab-button active" data-tab="status">
          <i class="fas fa-info-circle"></i>
          <span>Status</span>
        </button>
        <button class="tab-button" data-tab="performance">
          <i class="fas fa-tachometer-alt"></i>
          <span>Performance</span>
        </button>
        <button class="tab-button" data-tab="functions">
          <i class="fas fa-cogs"></i>
          <span>Functions</span>
        </button>
        <button class="tab-button" data-tab="settings">
          <i class="fas fa-sliders-h"></i>
          <span>Settings</span>
        </button>
        <button class="tab-button" data-tab="deleted-messages">
          <i class="fas fa-trash-alt"></i>
          <span>Deleted Messages</span>
        </button>
      </nav>

      <!-- Tab Content -->
      <div class="tab-container">
        <!-- Status Tab -->
        <div id="status-tab" class="tab-content active">
          <!-- Critical Status Bar - Always Visible -->
          <div class="card status-bar">
            <div class="stat">
              <span class="label">Uptime</span>
              <span id="uptime" class="value">--:--:--</span>
            </div>
            <div class="stat">
              <span class="label">Version</span>
              <span id="version" class="value">-.-.-</span>
            </div>
            <div class="stat">
              <span class="label">Messages</span>
              <span id="message-count" class="value">0</span>
            </div>
            <div class="stat">
              <span class="label">Discord Ping</span>
              <span id="discord-ping" class="value">-- ms</span>
            </div>
            <div class="status-actions">
              <button id="run-tests" class="btn btn-secondary" title="Run Tests">
                <i class="fas fa-flask"></i>
              </button>
              <button id="reset-stats" class="btn btn-warning" title="Reset Stats">
                <i class="fas fa-redo"></i>
              </button>
            </div>
          </div>

          <!-- System Health -->
          <div class="card combined-performance">
            <h2>System Health</h2>
            <div class="performance-overview">
              <div class="performance-chart">
                <canvas id="metrics-chart"></canvas>
              </div>
              <div class="performance-stats">
                <div class="stat-grid compact">
                  <div class="stat">
                    <span class="label">Response Time</span>
                    <span id="response-time" class="value">-- ms</span>
                    <span class="subtext">Avg: <span id="avg-response-time">-- ms</span></span>
                  </div>
                  <div class="stat">
                    <span class="label">CPU Usage</span>
                    <span id="cpu-usage" class="value">--%</span>
                    <span class="subtext">Process Load</span>
                  </div>
                  <div class="stat">
                    <span class="label">Memory</span>
                    <span id="memory-usage" class="value">-- MB</span>
                    <span class="subtext">RSS Memory</span>
                  </div>
                  <div class="stat">
                    <span class="label">API Calls</span>
                    <span id="total-api-calls" class="value">0</span>
                    <span class="subtext">Total Today</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- API Statistics -->
          <div class="card">
            <h2>API Usage</h2>
            <div id="api-stats" class="api-stats">
              <!-- API stats will be populated here -->
            </div>
          </div>

          <!-- Rate Limits -->
          <div class="card">
            <h2>Rate Limit Status</h2>
            <div id="rate-limits" class="rate-limits">
              <!-- Rate limit info will be populated here -->
            </div>
          </div>
        </div>

        <!-- Performance Tab -->
        <div id="performance-tab" class="tab-content">
          <div class="dashboard-grid">
            <!-- API Status Panel -->
            <section class="card status-panel">
              <h2>API STATUS</h2>
              <div class="status-indicator online">‚óè ONLINE</div>
              <div class="status-grid">
                <div class="status-item">
                  <span class="label">OpenAI</span>
                  <span class="value" id="openaiStatus">Operational</span>
                </div>
                <div class="status-item">
                  <span class="label">Weather</span>
                  <span class="value" id="weatherStatus">Operational</span>
                </div>
                <div class="status-item">
                  <span class="label">Quake</span>
                  <span class="value" id="quakeStatus">Operational</span>
                </div>
              </div>
            </section>

            <!-- LLM Providers -->
            <section class="card llm-providers">
              <h2>üß† AI MODELS</h2>
              <div class="llm-grid">
                <div class="llm-card primary">
                  <div class="llm-header">
                    <span class="llm-label">Primary LLM</span>
                    <span class="llm-status" id="primaryLLMStatus">‚óè</span>
                  </div>
                  <div class="llm-info">
                    <span class="llm-model" id="primaryLLMModel">GPT-4o-mini</span>
                    <span class="llm-provider" id="primaryLLMProvider">OpenAI</span>
                  </div>
                  <div class="llm-usage" id="primaryLLMUsage">
                    <span class="usage-tag">Chat</span>
                    <span class="usage-tag">Knowledge</span>
                    <span class="usage-tag">Weather</span>
                  </div>
                </div>
                <div class="llm-card image">
                  <div class="llm-header">
                    <span class="llm-label">Image Generation</span>
                    <span class="llm-status" id="imageLLMStatus">‚óè</span>
                  </div>
                  <div class="llm-info">
                    <span class="llm-model" id="imageLLMModel">DALL-E 3</span>
                    <span class="llm-provider" id="imageLLMProvider">OpenAI</span>
                  </div>
                  <div class="llm-usage" id="imageLLMUsage">
                    <span class="usage-tag">Art</span>
                    <span class="usage-tag">Images</span>
                  </div>
                </div>
              </div>
              <div class="search-engines">
                <h3>üîç Search Engines</h3>
                <div class="engine-status">
                  <div class="engine-item">
                    <span class="engine-name">SerpApi</span>
                    <span class="engine-status-indicator" id="serpApiStatus">‚óè</span>
                    <span class="engine-label">Primary</span>
                  </div>
                  <div class="engine-item">
                    <span class="engine-name">Brave</span>
                    <span class="engine-status-indicator" id="braveStatus">‚óè</span>
                    <span class="engine-label">Secondary</span>
                  </div>
                  <div class="engine-item">
                    <span class="engine-name">DuckDuckGo</span>
                    <span class="engine-status-indicator" id="duckduckgoStatus">‚óè</span>
                    <span class="engine-label">Fallback</span>
                  </div>
                </div>
              </div>
            </section>

            <!-- Active Request -->
            <section class="card active-request">
              <h2>ACTIVE REQUEST</h2>
              <div class="request-details">
                <div class="progress-container">
                  <div class="progress-bar" id="requestProgress" style="width: 0%"></div>
                </div>
                <div class="request-info">
                  <span id="currentEndpoint">-</span>
                  <span id="requestTime">0ms</span>
                </div>
              </div>
            </section>

            <!-- Memory Usage -->
            <section class="card memory-usage">
              <h2>MEMORY USAGE</h2>
              <div class="memory-gauge">
                <div class="gauge-fill" id="memoryGauge"></div>
                <div class="gauge-text" id="memoryText">0MB / 0MB</div>
              </div>
            </section>

            <!-- Latency Graph -->
            <section class="card latency-graph">
              <h2>API LATENCY (LAST 5 MIN)</h2>
              <div class="chart-container">
                <canvas id="latencyChart"></canvas>
              </div>
              <div class="latency-stats" id="latencyStats">
                <span>OpenAI: <span id="openaiLatency">-</span></span>
                <span>Weather: <span id="weatherLatency">-</span></span>
                <span>Other: <span id="otherLatency">-</span></span>
              </div>
            </section>

            <!-- Request History -->
            <section class="card request-history">
              <h2>REQUEST HISTORY</h2>
              <div class="history-list" id="requestHistory">
                <!-- Request history will be populated here -->
              </div>
            </section>
          </div>
        </div>

        <!-- Functions Tab -->
        <div id="functions-tab" class="tab-content">
          <!-- Function Results Summary -->
          <div class="card">
            <h2>Function Calls Summary</h2>
            <div id="function-summary" class="function-summary">
              <!-- Function summary will be populated here -->
            </div>
          </div>

          <!-- Blocked Users -->
          <div class="card">
            <h2>Blocked Users</h2>
            <div id="blocked-users-container" class="blocked-users">
              <!-- Blocked users will be populated here -->
            </div>
          </div>

          <!-- Images Gallery -->
          <div class="card">
            <h2>Generated Images</h2>
            <div id="images-gallery" class="images-gallery">
              <!-- Images will be populated here -->
            </div>
          </div>

          <!-- Weather Results -->
          <div class="card">
            <h2>Recent Weather Lookups</h2>
            <div id="weather-results" class="function-results">
              <!-- Weather results will be populated here -->
            </div>
          </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
          <div class="card">
            <h2>Environment Configuration</h2>

            <!-- Settings Filter -->
            <div class="settings-filter">
              <button class="filter-btn active" data-filter="all">All</button>
              <button class="filter-btn" data-filter="required">Required</button>
              <button class="filter-btn" data-filter="optional">Optional</button>
              <button class="filter-btn" data-filter="issues">Issues</button>
            </div>

            <!-- Settings Summary -->
            <div id="settings-summary" class="settings-summary">
              <!-- Summary will be populated here -->
            </div>

            <!-- Settings List -->
            <div id="settings-list" class="settings-list">
              <!-- Settings will be populated here -->
            </div>
          </div>
        </div>

        <!-- Deleted Messages Tab -->
        <div id="deleted-messages-tab" class="tab-content">
          <!-- Page Header Card -->
          <div class="card">
            <div class="card-header">
              <h2><i class="fas fa-trash-alt"></i> Deleted Messages Management</h2>
              <p>Monitor and manage user message deletions. Owner access only.</p>
            </div>

            <div id="deleted-error-container"></div>
            <div id="deleted-success-container"></div>

            <!-- Enhanced Stats Grid -->
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-trash-alt"></i></div>
                <div class="stat-number" id="deleted-total-messages">-</div>
                <div class="stat-label">Total Deleted</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-clock"></i></div>
                <div class="stat-number" id="deleted-pending-messages">-</div>
                <div class="stat-label">Pending Review</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-bolt"></i></div>
                <div class="stat-number" id="deleted-rapid-deletions">-</div>
                <div class="stat-label">Rapid Deletions</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-flag"></i></div>
                <div class="stat-number" id="deleted-flagged-messages">-</div>
                <div class="stat-label">Flagged</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-history"></i></div>
                <div class="stat-number" id="deleted-recent-count">-</div>
                <div class="stat-label">Last Hour</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-calendar-day"></i></div>
                <div class="stat-number" id="deleted-today-count">-</div>
                <div class="stat-label">Today</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-stopwatch"></i></div>
                <div class="stat-number" id="deleted-avg-time">-</div>
                <div class="stat-label">Avg Time to Delete</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                <div class="stat-number" id="deleted-high-priority">-</div>
                <div class="stat-label">High Priority</div>
              </div>
            </div>
          </div>

          <!-- Filters Card -->
          <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-filter"></i> Filter Messages</h3>
            </div>
            <div class="filters">
              <div class="filter-group">
                <label>Status:</label>
                <select id="deleted-status-filter">
                  <option value="">All Statuses</option>
                  <option value="pending_review">Pending Review</option>
                  <option value="approved">Approved</option>
                  <option value="flagged">Flagged</option>
                  <option value="ignored">Ignored</option>
                </select>

                <label>User ID:</label>
                <input type="text" id="deleted-user-filter" placeholder="Filter by user ID" />

                <label>Channel:</label>
                <input type="text" id="deleted-channel-filter" placeholder="Filter by channel ID" />
              </div>

              <div class="filter-group">
                <label>Start Date:</label>
                <input type="datetime-local" id="deleted-start-date" />

                <label>End Date:</label>
                <input type="datetime-local" id="deleted-end-date" />

                <label>Rapid Deletions Only:</label>
                <input type="checkbox" id="deleted-rapid-only" />

                <button class="btn btn-primary" onclick="applyDeletedMessagesFilters()">
                  <i class="fas fa-search"></i> Apply Filters
                </button>
                <button class="btn btn-secondary" onclick="loadDeletedMessages()">
                  <i class="fas fa-sync"></i> Refresh
                </button>
              </div>
            </div>
          </div>

          <!-- Analytics Row -->
          <div
            style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px"
          >
            <!-- User Leaderboard Card -->
            <div class="card">
              <div class="card-header">
                <h3><i class="fas fa-trophy"></i> User Leaderboard</h3>
              </div>
              <div id="user-leaderboard">
                <p class="text-muted text-center">Loading user statistics...</p>
              </div>
            </div>

            <!-- Channel Analytics Card -->
            <div class="card">
              <div class="card-header">
                <h3><i class="fas fa-chart-bar"></i> Channel Analytics</h3>
              </div>
              <div id="channel-analytics">
                <p class="text-muted text-center">Loading channel statistics...</p>
              </div>
            </div>
          </div>

          <!-- Bulk Actions -->
          <div id="bulk-actions" style="display: none">
            <div class="bulk-actions-header">
              <div class="bulk-actions-title"><i class="fas fa-check-square"></i> Bulk Actions</div>
              <div class="bulk-actions-count">
                <span id="selected-count">0</span> messages selected
              </div>
            </div>
            <div class="bulk-actions-buttons">
              <button class="btn btn-success" onclick="bulkUpdateStatus('approved')">
                <i class="fas fa-check"></i> Approve Selected
              </button>
              <button class="btn btn-danger" onclick="bulkUpdateStatus('flagged')">
                <i class="fas fa-flag"></i> Flag Selected
              </button>
              <button class="btn btn-warning" onclick="bulkUpdateStatus('ignored')">
                <i class="fas fa-eye-slash"></i> Ignore Selected
              </button>
              <button
                class="btn btn-secondary"
                onclick="selectedMessages.clear(); updateBulkActionsVisibility();"
              >
                <i class="fas fa-times"></i> Clear Selection
              </button>
            </div>
            <div id="bulk-progress" class="bulk-progress" style="display: none">
              <div class="bulk-progress-bar">
                <div id="bulk-progress-bar" class="bulk-progress-fill"></div>
              </div>
              <div id="bulk-progress-text" class="bulk-progress-text">Processing...</div>
            </div>
          </div>

          <!-- Messages Container Card -->
          <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-list"></i> Deleted Messages</h3>
              <div style="display: flex; gap: 10px; align-items: center">
                <button class="btn btn-sm" onclick="selectAllMessages()">
                  <i class="fas fa-check-square"></i> Select All
                </button>
                <span class="text-muted" style="font-size: 12px">
                  Check messages to enable bulk actions
                </span>
              </div>
            </div>
            <div class="messages-container">
              <div id="deleted-loading" class="loading" style="display: none">
                Loading deleted messages...
              </div>
              <div id="deleted-messages-list"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Debug Console (Bottom Left) -->
      <div id="debug-console" class="debug-console">
        <div class="debug-header">
          <span>Debug Console</span>
          <button id="debug-toggle" class="btn-icon-small">
            <i class="fas fa-chevron-up"></i>
          </button>
        </div>
        <div id="debug-content" class="debug-content">
          <div id="debug-messages" class="debug-messages"></div>
          <div class="debug-input">
            <input type="text" id="debug-command" placeholder="Enter command..." />
          </div>
        </div>
      </div>
    </div>

    <!-- Modal for images -->
    <div id="image-modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <img id="modal-image" src="" alt="Generated Image" />
        <div id="modal-caption"></div>
      </div>
    </div>

    <!-- Review Modal for Deleted Messages -->
    <div id="deleted-review-modal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeDeletedReviewModal()">&times;</span>
        <h2>Review Deleted Message</h2>
        <div id="deleted-modal-content"></div>
      </div>
    </div>

    <script src="bot-navigation.js"></script>
    <script src="app-unified.js"></script>
  </body>
</html>
